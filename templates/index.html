{% extends "base.html" %}

{% block content %}
    <form action="{{ url_for('scrape') }}" method="post">
        <input type="url" name="url" placeholder="Ссылка на учебник" required>
        <button type="submit">Поиск</button>
    </form>
        <table class="table table-hover table-dark">
            <thead>
                <tr>
                    <th scope="col">Обложка</th>
                     <th scope="col">Название</th>
                     <th scope="col">Авторы</th>
                     <th scope="col">Класс</th>
                     <th scope="col">Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for item in recent_scrapes %}
                <tr id="row-{{ item['_id'] }}">
                     <th>
                        <img class="rounded image zoom-image"
                              src="{{ url_for('static', filename=item['src'].split('static/')[1]) }}"/></th>
                     <th><a href="{{ item['url'] }}">{{ item['Title'] }}</a></th>
                     <th>{{ item['authors'] }}</th>
                     <th>{{ item['class'] }}</th>
                     <th>
                        <button class="btn btn-success edit-btn" id="edit-btn" data-id="{{ item['_id'] }}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-danger delete-btn" id="delete-btn" data-id="{{ item['_id'] }}">
                            <i class="bi bi-trash3"></i>
                        </button>
                     </th>
                </tr>
                {% endfor %}
            </tbody>
    </table>   

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function() {
            // Обработчик клика по кнопке удаления
            $('.delete-btn').click(function() {
                const itemId = $(this).data('id');
                if (confirm('Вы уверены, что хотите удалить эту строку?')) {
                     $.ajax({
                        url: '/delete',
                        data: {item_id: itemId},
                        type: 'POST',
                        success: function() {
                            // Удаляем строку из таблицы без перезагрузки страницы
                            $('#row-' + itemId).remove();
                        },
                        error: function(jqXHR, exception) {
                            console.log('Произошла ошибка при удалении', jqXHR.responseText);
                            alert('Произошла ошибка при удалении', jqXHR.responseText);
                        }
                    });
                }
            });
        });
    </script>
{% endblock %}